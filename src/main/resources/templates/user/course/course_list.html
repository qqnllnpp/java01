<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LangTrip - ê°•ì˜ ëª©ë¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/course_list.css}">
</head>
<body class="">
    <!-- Header -->
    <div th:replace="~{layout/header :: header}"></div>

    <main class="main-container">
        <div class="page-header">
            <div>
                <h1 class="page-title">ì „ì²´ ê°•ì˜</h1>
            </div>
        </div>

        <div class="search-filter-section">
            <form id="filterForm" th:action="@{/courses}" method="get">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="ì›í•˜ëŠ” ê°•ì˜ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”..." id="searchKeyword" name="searchKeyword" th:value="${searchKeyword}" />
                    <input type="hidden" name="searchType" value="title" /> <!-- Default search by title -->
                    <span class="search-icon" onclick="document.getElementById('filterForm').submit()">ğŸ”</span>
                </div>
                
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">ì¹´í…Œê³ ë¦¬</label>
                        <select class="filter-select" id="categoryFilter" name="category">
                            <option value="" th:selected="${category == null or category == ''}">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="ì˜ì–´" th:selected="${category == 'ì˜ì–´'}">ì˜ì–´</option>
                            <option value="ì¼ë³¸ì–´" th:selected="${category == 'ì¼ë³¸ì–´'}">ì¼ë³¸ì–´</option>
                            <option value="ì¤‘êµ­ì–´" th:selected="${category == 'ì¤‘êµ­ì–´'}">ì¤‘êµ­ì–´</option>
                            <!-- Add more categories as needed based on your DB -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">ë‚œì´ë„</label>
                        <select class="filter-select" id="difficultyFilter" name="difficulty">
                            <option value="" th:selected="${difficulty == null or difficulty == ''}">ì „ì²´ ë‚œì´ë„</option>
                            <option value="ì´ˆê¸‰" th:selected="${difficulty == 'ì´ˆê¸‰'}">ì´ˆê¸‰</option>
                            <option value="ì¤‘ê¸‰" th:selected="${difficulty == 'ì¤‘ê¸‰'}">ì¤‘ê¸‰</option>
                            <option value="ê³ ê¸‰" th:selected="${difficulty == 'ê³ ê¸‰'}">ê³ ê¸‰</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">ì •ë ¬</label>
                        <select class="filter-select" id="sortFilter" name="sort">
                            <option value="uploadDate,desc" th:selected="${sort == 'uploadDate,desc'}">ìµœì‹ ìˆœ</option>
                            <option value="uploadDate,asc" th:selected="${sort == 'uploadDate,asc'}">ì˜¤ë˜ëœìˆœ</option>
                            <option value="title,asc" th:selected="${sort == 'title,asc'}">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
                            <option value="title,desc" th:selected="${sort == 'title,desc'}">ì œëª© ë‚´ë¦¼ì°¨ìˆœ</option>
                            <option value="difficulty,asc" th:selected="${sort == 'difficulty,asc'}">ë‚œì´ë„ ë‚®ì€ìˆœ</option>
                            <option value="difficulty,desc" th:selected="${sort == 'difficulty,desc'}">ë‚œì´ë„ ë†’ì€ìˆœ</option>
                        </select>
                    </div>
                    
                    <div class="filter-buttons">
                        <button type="submit" class="filter-btn">ê²€ìƒ‰</button>
                        <button type="button" class="clear-filters" onclick="clearFilters()">ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- ê°•ì˜ ëª©ë¡ -->
        <div class="course-grid" id="courseGrid">
            <div class="course-card" th:each="course : ${courseList}">
                <div class="course-thumbnail">
                    <img th:src="${(course.thumbnailPath != null and course.thumbnailName != null) ? (course.thumbnailPath + course.thumbnailName) : '/images/default_thumbnail.png'}" alt="Course Thumbnail" style="width:100%; height:100%; object-fit: cover;"/>
                    <div class="course-level" th:text="${course.difficulty}"></div>
                </div>
                <div class="course-info">
                    <span class="course-category" th:text="${course.category}"></span>
                    <h3 class="course-title" th:text="${course.title}"></h3>
                    <div class="course-instructor">
                        <div class="instructor-avatar" th:text="${#strings.substring(course.instructorName, 0, 1)}"></div>
                        <span class="instructor-name" th:text="${course.instructorName}"></span>
                    </div>
                    <div class="course-stats">
                        <!-- Add actual stats if available in DTO -->
                    </div>
                    <div class="course-footer">
                        <a th:href="@{/ui/user_lecture(seq=${course.courseSeq})}" class="enroll-btn">ê°•ì˜ ë³´ê¸°</a>
                    </div>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(courseList)}" class="empty-state">
                <div class="empty-icon">ğŸ“š</div>
                <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ í•„í„° ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" th:if="${totalPages > 0}">
            <a th:if="${currentPage > 1}" th:href="@{/courses(page=${currentPage - 1}, pageSize=${pageSize}, searchType=${searchType}, searchKeyword=${searchKeyword}, sort=${sort}, category=${category}, difficulty=${difficulty})}">ì´ì „</a>
            <th:block th:each="pageNum : ${#numbers.sequence(startPage, endPage)}">
                <a th:href="@{/courses(page=${pageNum}, pageSize=${pageSize}, searchType=${searchType}, searchKeyword=${searchKeyword}, sort=${sort}, category=${category}, difficulty=${difficulty})}" 
                   th:text="${pageNum}" 
                   th:classappend="${pageNum == currentPage ? 'active' : ''}"></a>
            </th:block>
            <a th:if="${currentPage < totalPages}" th:href="@{/courses(page=${currentPage + 1}, pageSize=${pageSize}, searchType=${searchType}, searchKeyword=${searchKeyword}, sort=${sort}, category=${category}, difficulty=${difficulty})}">ë‹¤ìŒ</a>
        </div>
          <div th:replace="layout/footer :: footer"></div>
        
    </main>
    
    <script>
        function clearFilters() {
            document.getElementById('searchKeyword').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('difficultyFilter').value = '';
            document.getElementById('sortFilter').value = 'uploadDate,desc'; // Reset to default sort
            document.getElementById('filterForm').submit();
        }
    </script>
</body>
</html>